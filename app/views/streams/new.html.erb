<h1>New stream</h1>

<div class="row">
  <div class="col-md-6 col-md-offset-3" id="login-form">
    <%= form_for(@stream) do |f| %>

    <%= render 'fields', f: f %>

    <div id="btn-create" class="btn btn-primary">Create a stream</div>
    <%= f.submit "Create", class: "btn btn-primary hidden", id: "submit" %>
    </div>
    <% end %>
  </div>
</div>

<script type="text/javascript">
  var TIME = 250;

  var currentStep = 0;
  var steps = $('.step');
  steps.each(function(i, step) {
    if (i != 0) $(step).css('display', 'none');
  });
  //steps.first().removeClass('hidden');

  var btnBack   = $("#btn-back");
  var btnNext   = $("#btn-next");
  var btnCreate = $("#btn-create");
  var btnSubmit = $("#submit");

  var polling = $('.polling');

  var progress = $('#progress-bar');
  var ratio = progress.parent().width() / steps.length;
  //ratio = ratio + ratio / 10;

  var decreaseBar = function() {
    w = progress.width();
    progress.width(w - ratio);
  };

  var increaseBar = function() {
    w = progress.width();
    progress.width(w + ratio);
  };

  var back = function(event) {
    event.preventDefault();

    if (currentStep > 0) {
      if (currentStep == steps.length-1) {
        btnCreate.css('display', 'none');
        btnNext.css('display', 'inline-block');
        // btnNext.removeClass('btn-disabled').addClass('btn-primary');
      }

      steps.eq(currentStep).hide(TIME);
      currentStep--;
      steps.eq(currentStep).show(TIME);

      decreaseBar();

      if (currentStep == 0) {
        btnBack.css('display', 'none');
      }
    }
  };

  var next = function(event) {
    event.preventDefault();

    if (currentStep < steps.length-1) {
      btnBack.css('display', 'inline-block');

      steps.eq(currentStep).hide(TIME);
      currentStep++;
      steps.eq(currentStep).show(TIME);

      increaseBar();

      if (currentStep == steps.length-1) {
        btnCreate.css('display', 'inline-block');
        btnNext.css('display', 'none');
      }
    }
  };

  var create = function(event) {
    event.preventDefault();

    increaseBar();
    setTimeout(function() {
      btnSubmit.trigger('click');
    }, 500);

    // $(window).animate(function() {
    //   increaseBar();
    //   btnSubmit.trigger('submit');
    // }, 400);
  }

  var switchChanged = function(event) {
    event.preventDefault();
    polling.toggle(500);
  };



  btnBack.on('click', back).hide();
  btnNext.on('click', next);
  btnCreate.on('click', create).hide();

  $("#update-switch").on('switch-change', switchChanged);
</script>
